@model List<TheCoffeeShop.Models.SanPham>

@{
    ViewData["Title"] = "Tạo đơn hàng";
    Layout = "_Layout";
}

@{
    var donTam = ViewBag.GioHang as List<ChiTietDonHang> ?? new List<ChiTietDonHang>();
    var danhSach = ViewBag.DanhSachSanPham as List<SanPham> ?? new List<SanPham>();
}


<div class="row">
    <!-- Bên trái: Danh sách sản phẩm -->
    <div class="col-md-8">
        <h1>Danh sách sản phẩm</h1>

        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Mã sản phẩm</th>
                    <th>Tên sản phẩm</th>
                    <th>Mã danh mục</th>
                    <th>Đơn giá</th>
                    <th>Mô tả</th>
                    <th>Hình ảnh</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.MaSanPham</td>
                        <td>
                            <a href="javascript:void(0);" class="select-product"
                                data-masanpham="@item.MaSanPham"
                                data-ten="@item.TenSanPham"
                                data-madanhmuc="@item.MaDanhMuc"
                                data-dongia="@item.DonGia"
                                data-mota="@item.MoTa">
                                @item.TenSanPham
                            </a>
                        </td>
                        <td>@item.MaDanhMucNavigation?.TenDanhMuc</td>
                        <td>@item.DonGia</td>
                        <td>@item.MoTa</td>
                        <td>@item.HinhAnh</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <form asp-action="Index" method="get" class="row mb-3">
    <div class="col-md-4">
        <select name="maDanhMuc" class="form-select" asp-items="ViewBag.DanhMucs">
            <option value="">Chọn danh mục</option>
        </select>
    </div>
    <div class="col-md-4">
        <button type="submit" class="btn btn-success">Lọc</button>
    </div>
</form>

    <div class="col-md-4">
        <h4>Thêm sản phẩm mới</h4>
            <form asp-action="AddToOrder" asp-controller="Orders" method="post">
                @*<div asp-validation-summary="ModelOnly" class="text-danger"></div>*@
            <div class="form-group mb-2">
                <label for="TenSanPhamInput">Tên sản phẩm</label>
                <input type="text" id="TenSanPhamInput" name="TenSanPham" class="form-control" />
            </div>
            <div class="form-group mb-2">
                <label for="MaDanhMucInput">Mã danh mục</label>
                <input type="text" id="MaDanhMucInput" name="MaDanhMuc" class="form-control" />
            </div>
            <div class="form-group mb-2">
                <label for="DonGiaInput">Đơn giá</label>
                <input type="number" id="DonGiaInput" name="DonGia" class="form-control" />
            </div>
            <div class="form-group mb-2">
                <label for="SoLuongInput">Số lượng</label>
                <input type="number" id="SoLuongInput" name="SoLuong" value="1" class="form-control" min="1" />
            </div>
            <div class="form-group mb-2">
                <label for="GhiChuInput">Ghi chú</label>
                <input type="text" id="GhiChuInput" name="GhiChu" class="form-control" />
            </div>
            @*<div class="form-group">
                <input type="submit" value="Edit" class="btn btn-primary" />
            </div>*@
            <input type="hidden" name="maSanPham" id="MaSanPhamInput" /> 
            <div class="form-group mt-3 m">
                <button type="submit" class="btn btn-sm btn-success me-2">Thêm vào đơn</button>
                <button type="submit" asp-action="Index" class="btn btn-sm btn-success">Back to List</button>
            </div>
        </form>
    </div>

    @*@foreach (var item in Model)
    {
        if (item.MaDanhMuc == 1)
        {
            <p>@item.TenSanPham</p>
        }
        <form asp-action="Create">
            <div class="form-group">
                <label asp-for="MaDanhMuc" class="control-label"></label>
                <select asp-for="MaDanhMuc" class="form-control" asp-items="ViewBag.MaDanhMuc"></select>
                <span asp-validation-for="MaDanhMuc" class="text-danger"></span>
            </div>
        </form>
        
    }*@
</div>

@*<div>
    <a asp-action="Index" class="btn btn-secondary">Back to List</a>
</div>*@

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        document.querySelectorAll('.select-product').forEach(link => {
            link.addEventListener('click', function () {
                document.getElementById('TenSanPhamInput').value = this.getAttribute('data-ten');
                document.getElementById('MaDanhMucInput').value = this.getAttribute('data-madanhmuc');
                document.getElementById('DonGiaInput').value = this.getAttribute('data-dongia');
                document.getElementById('SoLuongInput').value = 1;
                document.getElementById('MaSanPhamInput').value = this.getAttribute('data-masanpham');
                //document.getElementById('MoTaInput').value = this.getAttribute('data-mota');
            });
        });
    </script>
}
